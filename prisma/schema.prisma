// Prisma schema for servicing ticket analysis

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

// Existing transcripts table (read-only)
model transcripts {
  id              String   @id @default(cuid())
  vendor_call_key String   @unique
  call_start      DateTime?
  duration_seconds Int?
  disposition     String?
  department      String?
  agent_name      String?
  messages        Json?

  // Relation to analysis
  TranscriptAnalysis TranscriptAnalysis[]
}

// Table to store deep AI analysis results for transcripts
// Each row represents one analyzed transcript
model TranscriptAnalysis {
  id        String   @id @default(cuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Transcript identifier (links to transcripts table)
  vendorCallKey String      @unique
  transcript    transcripts? @relation(fields: [vendorCallKey], references: [vendor_call_key])

  // Agent information
  agentName String?

  // Agent Sentiment Analysis
  agentSentiment       String? // "positive", "neutral", "negative"
  agentSentimentScore  Float?  // 0.0 to 1.0
  agentSentimentReason String? // Why this sentiment was assigned

  // Customer Sentiment Analysis
  customerSentiment       String? // "positive", "neutral", "negative"
  customerSentimentScore  Float?  // 0.0 to 1.0
  customerSentimentReason String? // Why this sentiment was assigned

  // AI-Discovered Topics
  aiDiscoveredTopic       String? // Main topic discovered by AI
  aiDiscoveredSubcategory String? // Subcategory discovered by AI
  topicConfidence         Float?  // 0.0 to 1.0 confidence

  // Key Issues and Resolution
  keyIssues  String[] // Array of key issues identified
  resolution String?  // How the issue was resolved

  // Tags
  tags String[] // Array of tags

  // Analysis metadata
  analyzedAt DateTime @default(now())
  model      String?  // AI model used for analysis

  @@index([vendorCallKey])
  @@index([agentSentiment])
  @@index([customerSentiment])
  @@index([aiDiscoveredTopic])
}
